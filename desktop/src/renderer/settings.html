<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è®¾ç½® - LiveGalGame</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', 'Noto Sans SC', sans-serif;
      background: linear-gradient(135deg, #fdf8fa 0%, #f9f0f4 100%);
      margin: 0;
      padding: 0;
      min-height: 100vh;
    }

    .back-link:hover {
      gap: 12px;
    }

    .error-message {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.2);
      color: #ef4444;
      padding: 12px;
      border-radius: 8px;
      margin-top: 12px;
      font-size: 14px;
    }

    .success-message {
      background: rgba(34, 197, 94, 0.1);
      border: 1px solid rgba(34, 197, 94, 0.2);
      color: #22c55e;
      padding: 12px;
      border-radius: 8px;
      margin-top: 12px;
      font-size: 14px;
    }

    .dark body {
      background: linear-gradient(135deg, #1a0a12 0%, #0d0510 100%);
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    .card {
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      padding: 24px;
      margin-bottom: 24px;
      transition: all 0.3s ease;
    }

    .card:hover {
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
    }

    .dark .card {
      background: rgba(15, 23, 42, 0.6);
      border-color: rgba(255, 255, 255, 0.1);
    }

    .section-title {
      font-size: 20px;
      font-weight: 600;
      color: #c51662;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .permission-status {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 12px;
      margin-bottom: 16px;
    }

    .dark .permission-status {
      background: rgba(30, 41, 59, 0.4);
    }

    .status-indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
    }

    .status-granted {
      background: #22c55e;
    }

    .status-denied {
      background: #ef4444;
    }

    .status-pending {
      background: #f59e0b;
    }

    .btn {
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      border: none;
      font-size: 14px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #c51662, #8e24aa);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(197, 22, 98, 0.3);
    }

    .btn-secondary {
      background: rgba(197, 22, 98, 0.1);
      color: #c51662;
    }

    .btn-secondary:hover {
      background: rgba(197, 22, 98, 0.2);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
    }

    .test-section {
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid rgba(0, 0, 0, 0.05);
    }

    .dark .test-section {
      border-top-color: rgba(255, 255, 255, 0.05);
    }

    .waveform-container {
      height: 60px;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 8px;
      margin: 16px 0;
      position: relative;
      overflow: hidden;
    }

    .dark .waveform-container {
      background: rgba(30, 41, 59, 0.4);
    }

    .waveform-bar {
      position: absolute;
      bottom: 0;
      width: 4px;
      background: linear-gradient(to top, #c51662, #8e24aa);
      border-radius: 2px;
      transition: height 0.1s ease;
    }

    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      color: #c51662;
      text-decoration: none;
      font-weight: 500;
      margin-bottom: 24px;
      transition: all 0.2s ease;
    }

    .back-link:hover {
      gap: 12px;
    }

    .error-message {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.2);
      color: #ef4444;
      padding: 12px;
      border-radius: 8px;
      margin-top: 12px;
      font-size: 14px;
    }

    .success-message {
      background: rgba(34, 197, 94, 0.1);
      border: 1px solid rgba(34, 197, 94, 0.2);
      color: #22c55e;
      padding: 12px;
      border-radius: 8px;
      margin-top: 12px;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="./index.html" class="back-link">
      â† è¿”å›
    </a>

    <h1 style="font-size: 28px; color: #c51662; margin-bottom: 32px; font-weight: 700;">è®¾ç½®</h1>

    <!-- éŸ³é¢‘æƒé™è®¾ç½® -->
    <div class="card">
      <div class="section-title">
        ğŸ¤ éŸ³é¢‘æƒé™
      </div>

      <div class="permission-status">
        <div style="display: flex; align-items: center;">
          <span class="status-indicator status-pending" id="mic-status-icon"></span>
          <div>
            <div style="font-weight: 500;" id="mic-status-text">æ£€æµ‹ä¸­...</div>
            <div style="font-size: 12px; color: #666; margin-top: 4px;" id="mic-status-detail">æ­£åœ¨æ£€æŸ¥éº¦å…‹é£æƒé™</div>
          </div>
        </div>
        <button class="btn btn-primary" id="request-mic-btn">è¯·æ±‚æƒé™</button>
      </div>

      <div class="test-section">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
          <div class="section-title" style="font-size: 16px; margin-bottom: 0;">
            ğŸµ éŸ³é¢‘æµ‹è¯•
          </div>
          <div style="display: flex; gap: 8px;">
            <button class="btn btn-secondary" id="test-mic-btn" disabled>å¼€å§‹æµ‹è¯•</button>
            <button class="btn btn-secondary" id="stop-test-btn" disabled>åœæ­¢</button>
          </div>
        </div>

        <div class="waveform-container" id="waveform-container" style="display: none;">
          <!-- æ³¢å½¢æ¡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>

        <div style="font-size: 12px; color: #666;" id="volume-indicator">
          éŸ³é‡ï¼š<span id="volume-value">0</span>%
        </div>

        <div id="test-message"></div>
      </div>
    </div>

    <!-- LLMé…ç½® -->
    <div class="card">
      <div class="section-title">
        ğŸ¤– LLMé…ç½®
      </div>

      <div style="margin-bottom: 16px;">
        <label style="display: block; font-weight: 500; margin-bottom: 8px; color: #333;">é…ç½®åç§°</label>
        <input type="text" id="llm-config-name" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;" placeholder="é»˜è®¤é…ç½®">
      </div>

      <div style="margin-bottom: 16px;">
        <label style="display: block; font-weight: 500; margin-bottom: 8px; color: #333;">æä¾›å•†</label>
        <select id="llm-provider" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;">
          <option value="openai">OpenAI</option>
        </select>
      </div>

      <div style="margin-bottom: 16px;">
        <label style="display: block; font-weight: 500; margin-bottom: 8px; color: #333;">API Key</label>
        <input type="password" id="llm-api-key" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;" placeholder="è¾“å…¥ä½ çš„APIå¯†é’¥">
      </div>

      <div style="margin-bottom: 16px;">
        <label style="display: block; font-weight: 500; margin-bottom: 8px; color: #333;">API Base URL <span style="font-weight: normal; color: #666;">(å¯é€‰)</span></label>
        <input type="text" id="llm-base-url" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;" placeholder="https://api.openai.com/v1 (ç•™ç©ºä½¿ç”¨é»˜è®¤)">
      </div>

      <div style="margin-bottom: 16px;">
        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
          <input type="checkbox" id="llm-is-default" style="width: 18px; height: 18px; cursor: pointer;">
          <span style="font-weight: 500; color: #333;">è®¾ä¸ºé»˜è®¤é…ç½®</span>
        </label>
      </div>

      <div id="llm-message"></div>

      <div style="display: flex; gap: 12px;">
        <button class="btn btn-primary" id="llm-save-btn">ä¿å­˜é…ç½®</button>
        <button class="btn btn-secondary" id="llm-test-btn">æµ‹è¯•è¿æ¥</button>
      </div>
    </div>
  </div>

  <script>
    // éŸ³é¢‘ç›¸å…³å˜é‡
    let audioContext = null;
    let mediaStream = null;
    let analyser = null;
    let dataArray = null;
    let animationId = null;
    let isTesting = false;

    // DOMå…ƒç´ 
    const micStatusIcon = document.getElementById('mic-status-icon');
    const micStatusText = document.getElementById('mic-status-text');
    const micStatusDetail = document.getElementById('mic-status-detail');
    const requestMicBtn = document.getElementById('request-mic-btn');
    const testMicBtn = document.getElementById('test-mic-btn');
    const stopTestBtn = document.getElementById('stop-test-btn');
    const waveformContainer = document.getElementById('waveform-container');
    const volumeValue = document.getElementById('volume-value');
    const testMessage = document.getElementById('test-message');

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
      checkMicrophonePermission();
      loadLLMConfig();
    });

    // æ£€æŸ¥éº¦å…‹é£æƒé™
    async function checkMicrophonePermission() {
      try {
        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
          updatePermissionStatus('unsupported', 'æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘è®¾å¤‡');
          return;
        }

        // å°è¯•è·å–æƒé™çŠ¶æ€ï¼ˆéœ€è¦httpsæˆ–localhostï¼‰
        if (navigator.permissions && navigator.permissions.query) {
          try {
            const permission = await navigator.permissions.query({ name: 'microphone' });
            console.log('Permission state:', permission.state);

            if (permission.state === 'granted') {
              updatePermissionStatus('granted', 'å·²æˆæƒ');
            } else if (permission.state === 'denied') {
              updatePermissionStatus('denied', 'è¢«æ‹’ç»');
            } else {
              updatePermissionStatus('prompt', 'éœ€è¦æˆæƒ');
            }
          } catch (e) {
            // æŸäº›æµè§ˆå™¨ä¸æ”¯æŒpermission.queryï¼Œå›é€€åˆ°ç›´æ¥æµ‹è¯•
            console.log('Permission API not available, testing directly');
            updatePermissionStatus('prompt', 'éœ€è¦æˆæƒ');
          }
        } else {
          // å›é€€æ–¹æ¡ˆ
          updatePermissionStatus('prompt', 'éœ€è¦æˆæƒ');
        }
      } catch (error) {
        console.error('Error checking permission:', error);
        updatePermissionStatus('error', 'æ£€æŸ¥å¤±è´¥');
      }
    }

    // æ›´æ–°æƒé™çŠ¶æ€æ˜¾ç¤º
    function updatePermissionStatus(status, text) {
      micStatusIcon.className = 'status-indicator';

      switch (status) {
        case 'granted':
          micStatusIcon.classList.add('status-granted');
          micStatusText.textContent = 'éº¦å…‹é£æƒé™ï¼š' + text;
          micStatusDetail.textContent = 'å¯ä»¥è¿›è¡ŒéŸ³é¢‘æµ‹è¯•';
          requestMicBtn.disabled = true;
          requestMicBtn.textContent = 'å·²æˆæƒ';
          testMicBtn.disabled = false;
          break;
        case 'denied':
          micStatusIcon.classList.add('status-denied');
          micStatusText.textContent = 'éº¦å…‹é£æƒé™ï¼š' + text;
          micStatusDetail.textContent = 'è¯·åœ¨ç³»ç»Ÿè®¾ç½®ä¸­æ‰‹åŠ¨æˆæƒ';
          requestMicBtn.disabled = false;
          requestMicBtn.textContent = 'é‡æ–°è¯·æ±‚';
          testMicBtn.disabled = true;
          break;
        case 'prompt':
          micStatusIcon.classList.add('status-pending');
          micStatusText.textContent = 'éº¦å…‹é£æƒé™ï¼š' + text;
          micStatusDetail.textContent = 'ç‚¹å‡»æŒ‰é’®è¯·æ±‚éº¦å…‹é£æƒé™';
          requestMicBtn.disabled = false;
          requestMicBtn.textContent = 'è¯·æ±‚æƒé™';
          testMicBtn.disabled = true;
          break;
        case 'error':
        default:
          micStatusIcon.classList.add('status-denied');
          micStatusText.textContent = 'éº¦å…‹é£æƒé™ï¼šæ£€æŸ¥å¤±è´¥';
          micStatusDetail.textContent = 'è¯·åˆ·æ–°é¡µé¢é‡è¯•';
          requestMicBtn.disabled = false;
          break;
      }
    }

    // è¯·æ±‚éº¦å…‹é£æƒé™
    requestMicBtn.addEventListener('click', async () => {
      try {
        testMessage.innerHTML = '';
        requestMicBtn.disabled = true;
        requestMicBtn.textContent = 'è¯·æ±‚ä¸­...';

        const stream = await navigator.mediaDevices.getUserMedia({
          audio: true
        });

        // ç«‹å³å…³é—­æµï¼ˆåªæ˜¯æµ‹è¯•æƒé™ï¼‰
        stream.getTracks().forEach(track => track.stop());

        updatePermissionStatus('granted', 'å·²æˆæƒ');
        showMessage('success', 'éº¦å…‹é£æƒé™å·²è·å–ï¼');
      } catch (error) {
        console.error('Error requesting microphone:', error);

        if (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError') {
          updatePermissionStatus('denied', 'è¢«æ‹’ç»');
          showMessage('error', 'éº¦å…‹é£æƒé™è¢«æ‹’ç»ã€‚è¯·åœ¨æµè§ˆå™¨è®¾ç½®ä¸­æ‰‹åŠ¨æˆæƒã€‚');
        } else if (error.name === 'NotFoundError' || error.name === 'DevicesNotFoundError') {
          updatePermissionStatus('error', 'æœªæ‰¾åˆ°éº¦å…‹é£è®¾å¤‡');
          showMessage('error', 'æœªæ‰¾åˆ°éº¦å…‹é£è®¾å¤‡ï¼Œè¯·æ£€æŸ¥è®¾å¤‡è¿æ¥ã€‚');
        } else {
          updatePermissionStatus('error', 'è¯·æ±‚å¤±è´¥');
          showMessage('error', 'è¯·æ±‚å¤±è´¥ï¼š' + error.message);
        }
      }
    });

    // å¼€å§‹éŸ³é¢‘æµ‹è¯•
    testMicBtn.addEventListener('click', async () => {
      try {
        testMessage.innerHTML = '';
        testMicBtn.disabled = true;
        stopTestBtn.disabled = false;

        // åˆ›å»ºéŸ³é¢‘ä¸Šä¸‹æ–‡
        audioContext = new (window.AudioContext || window.webkitAudioContext)();

        // è·å–éº¦å…‹é£è¾“å…¥
        mediaStream = await navigator.mediaDevices.getUserMedia({ audio: true });

        // åˆ›å»ºåˆ†æå™¨
        analyser = audioContext.createAnalyser();
        analyser.fftSize = 256;
        analyser.smoothingTimeConstant = 0.8;

        // è¿æ¥éŸ³é¢‘æºåˆ°åˆ†æå™¨
        const source = audioContext.createMediaStreamSource(mediaStream);
        source.connect(analyser);

        // åˆ›å»ºæ•°æ®æ•°ç»„
        dataArray = new Uint8Array(analyser.frequencyBinCount);

        // æ˜¾ç¤ºæ³¢å½¢å®¹å™¨
        waveformContainer.style.display = 'block';

        // ç”Ÿæˆæ³¢å½¢æ¡
        generateWaveformBars();

        // å¼€å§‹å¯è§†åŒ–
        isTesting = true;
        visualize();

        showMessage('success', 'éŸ³é¢‘æµ‹è¯•å·²å¼€å§‹ï¼Œå¯¹ç€éº¦å…‹é£è¯´è¯çœ‹çœ‹æ³¢å½¢å˜åŒ–ï¼');
      } catch (error) {
        console.error('Error starting audio test:', error);
        testMicBtn.disabled = false;
        stopTestBtn.disabled = true;
        showMessage('error', 'éŸ³é¢‘æµ‹è¯•å¤±è´¥ï¼š' + error.message);
      }
    });

    // åœæ­¢éŸ³é¢‘æµ‹è¯•
    stopTestBtn.addEventListener('click', () => {
      stopAudioTest();
      showMessage('success', 'éŸ³é¢‘æµ‹è¯•å·²åœæ­¢');
    });

    // ç”Ÿæˆæ³¢å½¢æ¡
    function generateWaveformBars() {
      waveformContainer.innerHTML = '';
      const barCount = 40;
      const barWidth = 4;
      const barGap = 2;
      const containerWidth = barCount * (barWidth + barGap) - barGap;

      waveformContainer.style.width = containerWidth + 'px';

      for (let i = 0; i < barCount; i++) {
        const bar = document.createElement('div');
        bar.className = 'waveform-bar';
        bar.style.left = i * (barWidth + barGap) + 'px';
        bar.style.width = barWidth + 'px';
        bar.style.height = '2px';
        waveformContainer.appendChild(bar);
      }
    }

    // å¯è§†åŒ–éŸ³é¢‘
    function visualize() {
      if (!isTesting || !analyser) return;

      analyser.getByteFrequencyData(dataArray);

      const bars = waveformContainer.querySelectorAll('.waveform-bar');
      let sum = 0;

      for (let i = 0; i < bars.length; i++) {
        const index = Math.floor((i / bars.length) * dataArray.length);
        const value = dataArray[index];
        const percent = value / 255;
        const height = Math.max(2, percent * 60);

        bars[i].style.height = height + 'px';
        sum += value;
      }

      // è®¡ç®—å¹³å‡éŸ³é‡
      const average = sum / dataArray.length;
      const volume = Math.round((average / 255) * 100);
      volumeValue.textContent = volume;

      animationId = requestAnimationFrame(visualize);
    }

    // åœæ­¢éŸ³é¢‘æµ‹è¯•
    function stopAudioTest() {
      isTesting = false;

      if (animationId) {
        cancelAnimationFrame(animationId);
        animationId = null;
      }

      if (mediaStream) {
        mediaStream.getTracks().forEach(track => track.stop());
        mediaStream = null;
      }

      if (audioContext) {
        audioContext.close();
        audioContext = null;
      }

      analyser = null;
      dataArray = null;

      // éšè—æ³¢å½¢
      waveformContainer.style.display = 'none';

      // é‡ç½®æŒ‰é’®çŠ¶æ€
      testMicBtn.disabled = false;
      stopTestBtn.disabled = true;

      // é‡ç½®éŸ³é‡æ˜¾ç¤º
      volumeValue.textContent = '0';
    }

    // æ˜¾ç¤ºæ¶ˆæ¯
    function showMessage(type, message) {
      const messageDiv = document.createElement('div');
      messageDiv.className = type === 'error' ? 'error-message' : 'success-message';
      messageDiv.textContent = message;
      testMessage.appendChild(messageDiv);

      setTimeout(() => {
        messageDiv.remove();
      }, 5000);
    }

    // é¡µé¢å¸è½½æ—¶åœæ­¢éŸ³é¢‘æµ‹è¯•
    window.addEventListener('beforeunload', () => {
      stopAudioTest();
    });

    // ========== LLMé…ç½®ç›¸å…³ ==========
    const llmConfigName = document.getElementById('llm-config-name');
    const llmProvider = document.getElementById('llm-provider');
    const llmApiKey = document.getElementById('llm-api-key');
    const llmBaseUrl = document.getElementById('llm-base-url');
    const llmIsDefault = document.getElementById('llm-is-default');
    const llmSaveBtn = document.getElementById('llm-save-btn');
    const llmTestBtn = document.getElementById('llm-test-btn');
    const llmMessage = document.getElementById('llm-message');

    let currentLLMConfig = null;

    // åŠ è½½LLMé…ç½®
    async function loadLLMConfig() {
      try {
        if (window.electronAPI && window.electronAPI.getDefaultLLMConfig) {
          const config = await window.electronAPI.getDefaultLLMConfig();
          if (config) {
            currentLLMConfig = config;
            llmConfigName.value = config.name || '';
            llmProvider.value = config.provider || 'openai';
            llmApiKey.value = config.api_key || '';
            llmBaseUrl.value = config.base_url || '';
            llmIsDefault.checked = config.is_default === 1;
          }
        }
      } catch (error) {
        console.error('Failed to load LLM config:', error);
      }
    }

    // æ˜¾ç¤ºæ¶ˆæ¯
    function showLLMMessage(type, message) {
      llmMessage.innerHTML = '';
      const messageDiv = document.createElement('div');
      messageDiv.className = type === 'error' ? 'error-message' : 'success-message';
      messageDiv.textContent = message;
      llmMessage.appendChild(messageDiv);

      setTimeout(() => {
        messageDiv.remove();
      }, 5000);
    }

    // ä¿å­˜LLMé…ç½®
    llmSaveBtn.addEventListener('click', async () => {
      try {
        const apiKey = llmApiKey.value.trim();
        if (!apiKey) {
          showLLMMessage('error', 'è¯·è¾“å…¥API Key');
          return;
        }

        llmSaveBtn.disabled = true;
        llmSaveBtn.textContent = 'ä¿å­˜ä¸­...';

        const configData = {
          id: currentLLMConfig?.id,
          name: llmConfigName.value.trim() || 'é»˜è®¤é…ç½®',
          provider: llmProvider.value,
          api_key: apiKey,
          base_url: llmBaseUrl.value.trim() || null,
          is_default: llmIsDefault.checked ? 1 : 0
        };

        const savedConfig = await window.electronAPI.saveLLMConfig(configData);
        currentLLMConfig = savedConfig;

        showLLMMessage('success', 'é…ç½®å·²ä¿å­˜');
        llmSaveBtn.textContent = 'ä¿å­˜é…ç½®';
        llmSaveBtn.disabled = false;
      } catch (error) {
        console.error('Failed to save LLM config:', error);
        showLLMMessage('error', 'ä¿å­˜å¤±è´¥ï¼š' + (error.message || 'æœªçŸ¥é”™è¯¯'));
        llmSaveBtn.textContent = 'ä¿å­˜é…ç½®';
        llmSaveBtn.disabled = false;
      }
    });

    // æµ‹è¯•LLMè¿æ¥
    llmTestBtn.addEventListener('click', async () => {
      try {
        const apiKey = llmApiKey.value.trim();
        if (!apiKey) {
          showLLMMessage('error', 'è¯·è¾“å…¥API Key');
          return;
        }

        llmTestBtn.disabled = true;
        llmTestBtn.textContent = 'æµ‹è¯•ä¸­...';

        const configData = {
          provider: llmProvider.value,
          api_key: apiKey,
          base_url: llmBaseUrl.value.trim() || null
        };

        const result = await window.electronAPI.testLLMConnection(configData);

        if (result.success) {
          showLLMMessage('success', result.message || 'è¿æ¥æˆåŠŸï¼');
        } else {
          showLLMMessage('error', result.message || 'è¿æ¥å¤±è´¥');
        }

        llmTestBtn.textContent = 'æµ‹è¯•è¿æ¥';
        llmTestBtn.disabled = false;
      } catch (error) {
        console.error('Failed to test LLM connection:', error);
        showLLMMessage('error', 'æµ‹è¯•å¤±è´¥ï¼š' + (error.message || 'æœªçŸ¥é”™è¯¯'));
        llmTestBtn.textContent = 'æµ‹è¯•è¿æ¥';
        llmTestBtn.disabled = false;
      }
    });


    // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
      checkMicrophonePermission();
      loadLLMConfig();
    });

    console.log('Settings page loaded');
  </script>
</body>
</html>

# UI 设计文档：对话窗口（聊天界面）

> **原型图参考**：Image 1 - 与 Evelyn 的对话窗口  
> **对应功能**：实时对话 HUD，AI 建议生成与选择

---

## 1. 整体布局

### 1.1 窗口属性
- **窗口类型**：半透明浮动窗口（Always-on-Top）
- **默认尺寸**：宽 440px，高度自适应内容（最小 600px，最大 800px）
- **背景**：深灰色磨砂半透明 `rgba(68, 68, 68, 0.95)`，带 `backdrop-filter: blur(20px)`
- **圆角**：16px
- **阴影**：`0 8px 32px rgba(0, 0, 0, 0.4)`
- **可拖拽**：标题栏区域可拖动整个窗口
- **位置记忆**：关闭后记住上次位置，下次启动时恢复

### 1.2 布局结构（从上到下）
```
┌─────────────────────────────────────────┐
│ [标题栏]  对话: Evelyn       [-][□][×]  │ ← 高度 48px
├─────────────────────────────────────────┤
│                                         │
│  [对话气泡区域]                          │ ← 可滚动，flex-grow
│  └─ 左侧气泡（对方）                     │
│  └─ 右侧气泡（自己）                     │
│      └─ 标星标记（重要内容）             │
│                                         │
├─────────────────────────────────────────┤
│ [AI 推荐区域]                            │ ← 高度自适应（0-240px）
│  "你似乎对此了解很多..."                 │
│  └─ [拒绝 按钮] [暧昧回应 按钮]          │
│  "这是一条危险的路..."                   │
│  └─ [中性 按钮] [创意 按钮]              │
│                                         │
├─────────────────────────────────────────┤
│ AI 思考中...                            │ ← 加载状态，高 32px
├─────────────────────────────────────────┤
│ [底部操作栏]                            │ ← 高度 64px
│  [😊] [⏸] [✨] [⚙]                    │
└─────────────────────────────────────────┘
```

---

## 2. 标题栏（Title Bar）

### 2.1 视觉规范
- **高度**：48px
- **背景**：渐变 `linear-gradient(135deg, #D91B5C 0%, #C2185B 100%)`（品牌粉红色）
- **文字**：白色，字体 16px，粗体（font-weight: 600）
- **格式**：`对话: {角色名称}`（左对齐，左边距 16px）
- **右侧按钮**：
  - 最小化 `−`、最大化 `□`、关闭 `×`
  - 尺寸：每个 32×32px，hover 时背景变为 `rgba(255,255,255,0.2)`
  - 间距：按钮间距 4px，右边距 8px

### 2.2 交互行为
- **拖拽**：鼠标在标题栏任意位置按下可拖动窗口
- **双击**：双击标题栏切换最大化/还原
- **最小化**：窗口缩小到托盘/任务栏，对话继续监听
- **关闭**：弹出确认对话框 "是否保存并退出对话？"，有 "保存"/"放弃"/"取消" 三个选项

---

## 3. 对话气泡区域

### 3.1 容器属性
- **背景**：透明
- **内边距**：上下 16px，左右 16px
- **滚动**：`overflow-y: auto`，自定义滚动条样式（宽 6px，深灰色轨道，浅灰色滑块）
- **排列**：垂直 Flexbox，从上到下

### 3.2 对方消息气泡（左侧）
```
┌────────────────────────────────┐
│ 没想到今晚会在这里见到你。      │
├────────────────────────────────┤
│ 这个城市充满了惊喜，不是吗？    │
└────────────────────────────────┘
```

**样式规范**：
- **对齐**：左对齐（margin-right: auto）
- **最大宽度**：70%
- **背景色**：`rgba(100, 116, 139, 0.3)`（浅灰蓝半透明）
- **文字颜色**：`#E2E8F0`（浅灰白）
- **字体**：14px，行高 1.6
- **内边距**：12px 16px
- **圆角**：
  - 左上 4px，右上 16px
  - 左下 16px，右下 16px
  - （模拟对话气泡的"尾巴"在左上）
- **间距**：相邻气泡间距 8px
- **连续消息**：如果连续多条来自同一方，第一条用完整圆角，中间条用统一圆角 12px，最后一条用"尾巴"圆角

### 3.3 自己的消息气泡（右侧）
```
                      ┌────────────────────────────┐
                      │ 听起来真不错！也可以这么说，│
                      │ 我听说你在调查"猩红集团"的 │
                      │ 案子。                  ⭐│
                      └────────────────────────────┘
```

**样式规范**：
- **对齐**：右对齐（margin-left: auto）
- **最大宽度**：70%
- **背景色**：`rgba(217, 27, 92, 0.2)`（品牌粉色半透明）
- **文字颜色**：`#FFF`（纯白）
- **字体**：14px，行高 1.6
- **内边距**：12px 16px
- **圆角**：
  - 左上 16px，右上 4px
  - 左下 16px，右下 16px
  - （"尾巴"在右上）
- **星标标记**：
  - 位置：右下角，绝对定位 `bottom: 4px, right: 4px`
  - 图标：⭐（红色五角星，尺寸 16px）
  - 显示条件：该消息被 AI 标记为"攻略关键点"时显示
  - Hover 提示：显示 tooltip "关键进展：好感度 +20"

### 3.4 消息元数据
- **时间戳**：每条消息气泡下方居中显示，格式 `14:32`
- **样式**：10px，颜色 `rgba(255,255,255,0.4)`，上边距 4px
- **合并规则**：1 分钟内的连续消息不重复显示时间

---

## 4. AI 推荐区域

### 4.1 整体布局
- **触发时机**：检测到对方说话结束后 2 秒，从底部滑入动画（300ms ease-out）
- **背景**：`rgba(30, 30, 30, 0.95)`，顶部有 1px 分隔线 `rgba(255,255,255,0.1)`
- **内边距**：16px
- **最大高度**：240px，超出部分可滚动

### 4.2 推荐卡片结构
每个推荐选项为一个卡片，结构如下：

```
┌────────────────────────────────────────┐
│ "你似乎对此了解很多。愿意分享一下吗？" │ ← 建议文本
│                                        │
│  [拒绝]            [暧昧回应]          │ ← 标签按钮
└────────────────────────────────────────┘
```

**卡片样式**：
- **背景**：`rgba(51, 65, 85, 0.6)`（深蓝灰）
- **圆角**：12px
- **内边距**：12px 16px
- **边框**：1px solid transparent（默认），hover 时变为 `rgba(217, 27, 92, 0.5)`
- **间距**：卡片之间 12px
- **过渡**：所有 hover 效果 200ms ease

### 4.3 建议文本
- **字体**：15px，行高 1.5
- **颜色**：`#FFF`
- **最大行数**：3 行，超出显示省略号
- **引号**：使用中文双引号 `" "`

### 4.4 标签按钮
- **布局**：Flexbox 横向排列，`justify-content: space-between`
- **单个按钮**：
  - **尺寸**：高 32px，宽度自适应（最小 80px），水平内边距 16px
  - **背景色**：根据标签类型变化：
    - 拒绝：`rgba(239, 68, 68, 0.2)` + 红色边框
    - 暧昧回应：`rgba(236, 72, 153, 0.3)` + 粉色边框
    - 中性：`rgba(148, 163, 184, 0.2)` + 灰色边框
    - 创意：`rgba(59, 130, 246, 0.3)` + 蓝色边框
  - **文字**：12px，粗体 500，颜色对应标签色（高亮版本）
  - **圆角**：6px
  - **Hover**：背景不透明度增加到 0.5，指针变为 pointer
  - **点击效果**：按钮缩放 0.95，100ms 后恢复

### 4.5 效果预测徽章（可选）
- **位置**：在标签按钮右侧，间距 8px
- **格式**：`❤️ +20` 或 `❤️ -5`
- **样式**：
  - 字体 11px
  - 正值：绿色 `#10B981`
  - 负值：橙色 `#F59E0B`
  - 背景：`rgba(0,0,0,0.3)`，圆角 4px，内边距 2px 6px

### 4.6 关闭按钮
- **位置**：推荐区域右上角
- **图标**：`×`，尺寸 20px
- **样式**：颜色 `rgba(255,255,255,0.5)`，hover 时 `#FFF`
- **行为**：点击后推荐区域向下滑出消失（300ms），用户可以手动输入

---

## 5. AI 状态指示器

### 5.1 思考状态
```
AI 思考中...
```
- **显示时机**：对方消息结束后，AI 生成建议的等待期间
- **位置**：推荐区域上方，独立一行
- **背景**：`rgba(59, 130, 246, 0.1)`（淡蓝色）
- **高度**：32px
- **文字**：
  - 内容：`AI 思考中...`（带动画三个点循环显示）
  - 字体：13px，斜体
  - 颜色：`#60A5FA`（淡蓝色）
  - 居中对齐
- **动画**：脉冲效果（opacity 0.6 ↔ 1.0，1.5s 循环）

### 5.2 错误状态
- **显示时机**：AI 调用失败或超时（5 秒）
- **样式**：
  - 背景变为 `rgba(239, 68, 68, 0.15)`（淡红色）
  - 文字：`AI 暂时无法响应，请检查网络或稍后重试`
  - 颜色：`#F87171`（红色）
  - 右侧显示"重试"按钮（小型按钮，60px 宽）

---

## 6. 底部操作栏

### 6.1 布局
- **高度**：64px
- **背景**：`rgba(30, 30, 30, 0.95)`，顶部 1px 分隔线
- **内边距**：16px
- **布局**：Flexbox 横向居中排列，`gap: 24px`

### 6.2 按钮定义
```
[😊]      [⏸]       [✨]      [⚙]
情绪    暂停监听   AI助手   设置
```

#### 按钮通用样式
- **尺寸**：48×48px 圆形按钮
- **背景**：`rgba(100, 116, 139, 0.3)`
- **图标**：24×24px，颜色 `#E2E8F0`
- **Hover**：背景变为 `rgba(217, 27, 92, 0.5)`，图标放大 1.1 倍（200ms 过渡）
- **Active**：背景变为品牌粉色 `#D91B5C`，图标为白色

#### 各按钮功能
1. **情绪按钮（😊）**：
   - 点击展开情绪表情选择器（emoji picker）
   - 用途：手动标记当前对话的情绪氛围
   - 选择器：弹出在按钮上方，5×4 网格，包含常用表情

2. **暂停/播放按钮（⏸/▶）**：
   - 切换监听状态
   - 暂停时：图标变为 `▶`，背景变为橙色 `#F59E0B`
   - 作用：临时停止音频捕获和 AI 分析

3. **AI 助手按钮（✨）**：
   - 点击手动触发 AI 建议生成
   - 作用：当 AI 未自动响应时，用户可以主动请求建议
   - 状态：生成中时旋转动画（360° 无限循环）

4. **设置按钮（⚙）**：
   - 点击打开快速设置菜单（下拉弹窗）
   - 包含：
     - 切换对话对象
     - 调整透明度（滑块 50%-100%）
     - 快捷键设置
     - 返回主窗口

---

## 7. 交互动画与过渡

### 7.1 消息发送动画
1. 用户参考建议后说话
2. 新气泡从右侧 150% 位置滑入（300ms ease-out）
3. 同时透明度 0 → 1
4. 如果是关键进展，星标延迟 500ms 后闪烁出现（scale 0.5 → 1.2 → 1.0）

### 7.2 好感度变化动画
- **触发**：AI 判定产生好感度变化时
- **动画**：
  1. 在相关消息气泡上方飘出数字 `+20`
  2. 颜色为绿色 `#10B981`，字体 18px 粗体
  3. 向上移动 40px，同时透明度 1 → 0（1000ms）
  4. 移动曲线使用 `cubic-bezier(0.25, 0.46, 0.45, 0.94)`

### 7.3 推荐区域滑入/滑出
- **滑入**：从 `translateY(100%)` 到 `translateY(0)`，300ms ease-out
- **滑出**：从 `translateY(0)` 到 `translateY(100%)`，300ms ease-in
- **高度过渡**：max-height 从 0 到实际高度（300ms）

---

## 8. 响应式与状态管理

### 8.1 窗口尺寸变化
- **最小宽度**：360px
- **最小高度**：480px
- **缩放规则**：
  - 气泡最大宽度按比例调整（始终为容器宽度的 70%）
  - 推荐区域在宽度 < 400px 时，标签按钮堆叠为单列

### 8.2 焦点状态
- **窗口失焦**：整体透明度降低到 0.8
- **窗口重新获得焦点**：透明度恢复到 1.0（200ms 过渡）

### 8.3 深色/浅色模式（预留）
当前仅支持深色模式，未来可扩展浅色主题变量：
```css
--bg-primary: rgba(68, 68, 68, 0.95);
--text-primary: #E2E8F0;
--accent-color: #D91B5C;
```

---

## 9. 无障碍（Accessibility）

### 9.1 键盘导航
- **Tab 键**：按钮间循环聚焦
- **Enter/Space**：激活聚焦的按钮
- **Esc**：关闭推荐区域或设置菜单
- **Ctrl+W**：关闭窗口（弹出确认）

### 9.2 屏幕阅读器
- 所有按钮添加 `aria-label` 属性
- 消息气泡添加 `role="log"` 和 `aria-live="polite"`
- 推荐卡片添加 `role="option"` 和 `aria-describedby`

### 9.3 对比度
- 所有文字与背景对比度 ≥ 4.5:1（符合 WCAG AA 标准）
- 交互元素对比度 ≥ 3:1

---

## 10. 技术实现提示

### 10.1 React 组件结构建议
```jsx
<ChatWindow>
  <TitleBar title="对话: Evelyn" onClose={handleClose} />
  <MessageList messages={messages}>
    {messages.map(msg => (
      msg.role === 'user' 
        ? <UserBubble key={msg.id} {...msg} />
        : <PartnerBubble key={msg.id} {...msg} />
    ))}
  </MessageList>
  {aiState === 'thinking' && <AIThinkingIndicator />}
  {suggestions.length > 0 && (
    <SuggestionPanel 
      suggestions={suggestions} 
      onSelect={handleSelect}
      onDismiss={handleDismiss}
    />
  )}
  <ActionBar 
    onEmoji={showEmojiPicker}
    onPause={toggleListening}
    onAI={requestSuggestion}
    onSettings={openSettings}
  />
</ChatWindow>
```

### 10.2 样式方案
- 使用 **Tailwind CSS** + 自定义主题变量
- 或使用 **Styled Components** 实现动态主题切换
- 动画使用 **Framer Motion** 库简化实现

### 10.3 性能优化
- 消息列表使用虚拟滚动（react-window），支持 1000+ 条消息
- 推荐卡片懒加载，仅渲染可见区域
- 防抖用户输入事件（300ms）

---

## 11. 设计资源清单

### 11.1 图标资源
- 推荐使用 **Lucide Icons** 或 **Heroicons**
- 需要的图标：
  - Minimize, Maximize, Close
  - Smile (Emoji), Pause, Play, Sparkles, Settings
  - Star (filled/outline)
  - X (close small)

### 11.2 字体
- **主字体**：思源黑体（Noto Sans SC）或 苹方（PingFang SC）
- **等宽字体**（代码/时间戳）：JetBrains Mono

### 11.3 颜色变量表
```css
:root {
  /* 品牌色 */
  --brand-primary: #D91B5C;
  --brand-gradient: linear-gradient(135deg, #D91B5C 0%, #C2185B 100%);
  
  /* 背景 */
  --bg-window: rgba(68, 68, 68, 0.95);
  --bg-panel: rgba(30, 30, 30, 0.95);
  --bg-card: rgba(51, 65, 85, 0.6);
  
  /* 气泡 */
  --bubble-partner: rgba(100, 116, 139, 0.3);
  --bubble-user: rgba(217, 27, 92, 0.2);
  
  /* 文字 */
  --text-primary: #FFFFFF;
  --text-secondary: #E2E8F0;
  --text-muted: rgba(255, 255, 255, 0.4);
  
  /* 标签 */
  --tag-reject: rgba(239, 68, 68, 0.2);
  --tag-flirt: rgba(236, 72, 153, 0.3);
  --tag-neutral: rgba(148, 163, 184, 0.2);
  --tag-creative: rgba(59, 130, 246, 0.3);
  
  /* 状态 */
  --status-success: #10B981;
  --status-warning: #F59E0B;
  --status-error: #F87171;
  --status-info: #60A5FA;
}
```

---

## 12. 验收标准

### 12.1 视觉还原度
- [ ] 窗口圆角、阴影与原型一致
- [ ] 品牌色渐变在标题栏正确显示
- [ ] 消息气泡"尾巴"圆角正确（左/右差异）
- [ ] 星标图标仅在关键消息显示
- [ ] 推荐卡片标签颜色与原型匹配

### 12.2 交互流畅性
- [ ] 窗口拖拽无卡顿（60fps）
- [ ] 消息滑入动画自然（300ms 以内）
- [ ] 好感度数字飘出动画清晰可见
- [ ] 推荐区域滑入/滑出无闪烁
- [ ] 按钮 hover/active 状态响应 < 100ms

### 12.3 功能完整性
- [ ] 消息自动滚动到最新一条
- [ ] 暂停按钮正确切换音频监听状态
- [ ] 点击推荐后自动填充到对话
- [ ] 关闭窗口弹出保存确认
- [ ] 设置菜单正确打开并响应操作

### 12.4 跨平台一致性
- [ ] Windows 和 macOS 窗口控制按钮位置符合平台规范
- [ ] 字体渲染在两平台清晰
- [ ] 透明效果在两平台正常（Windows 使用 Acrylic，macOS 使用 Vibrancy）

---

**文档版本**：v1.0  
**最后更新**：2025-11-12  
**维护者**：产品设计团队


# UI 设计文档：对话详情 / 分析页面（AI 复盘与数据化反馈）

> **原型图参考**：Image 4 - 与 Miyu 的对话（对话详情与分析）  
> **对应功能**：对话内容展示、AI 分析、好感度曲线、复盘建议

---

## 1. 整体布局

### 1.1 页面属性
- **页面类型**：主窗口内容区域
- **尺寸**：全屏适配，最小 1200px × 800px
- **背景**：浅白色 `#F5F7FA`
- **布局**：三列设计（侧栏 + 中间对话 + 右侧分析）

### 1.2 整体结构
```
┌──────────────────────────────────────────────────────────────────┐
│ [侧边栏]           [中间对话区]                  [右侧分析板]    │
│                                                                  │
│ ◆ 总览            与 Miyu 的对话 ✓         [AI 分析与编辑]      │
│ ◆ 攻略对象        这是你的对话项目快照。                         │
│ ◆ 对话编辑器                              [AI 洞察]            │
│ ◆ LLM 配置      ┌────────────────┐       ┌──────────────────┐ │
│ ◆ 设置          │ [攻略对象]     │       │ 你似乎平衡了    │ │
│                │ [对话]         │       │ 主动性与被动性  │ │
│                │ [分享]         │       │ 很好！         │ │
│                │ [故事标记]     │       │                │ │
│                └────────────────┘       │ [编辑消息]      │ │
│ [帮助]                                 │                │ │
│ [报告问题]     ┌────────────────┐       │ [编辑消息]      │ │
│ [登出]         │ Miyu: 呃,真的吗?│       │                │ │
│                │ 不过这听起来...│       │ [暂无推荐]      │ │
│                │ 我当然愿意！  │       │                │ │
│                │               │       │ [进一步建议]    │ │
│                │ 我: 我当然愿意│       │                │ │
│                │ 让我试试...   │       │                │ │
│                │               │       │ [AI 复盘]       │ │
│                │ Miyu: 听起来...│       │ 你做得很棒...  │ │
│                │ 对我很特别   │       │                │ │
│                │               │       │ [查看完整分析] │ │
│                │ [💭 思考中]   │       │                │ │
│                │ [+ 添加消息]  │       │                │ │
│                └────────────────┘       └──────────────────┘
│
└──────────────────────────────────────────────────────────────────┘
```

---

## 2. 侧边栏导航（同前）

### 2.1 结构
- 与 LLM Config、Dashboard 相同的侧边栏
- 当前高亮：`◆ 对话编辑器`
- 参考 `ui-design-02-llm-config.md` 第 2 节

---

## 3. 顶部标题栏（中间列）

### 3.1 标题栏布局
```
与 Miyu 的对话 ✓                    [⏮ 上一个] [下一个 ⏭] [⋮ 更多]
这是你的对话项目快照。
```

- **高度**：80px
- **背景**：白色 `#FFFFFF`
- **边框**：底部 1px solid `#E5E7EB`
- **内边距**：20px 40px
- **布局**：Flexbox 列方向，上方标题行，下方按钮/时间行

### 3.2 标题行
- **布局**：Flex row，`justify-content: space-between, align-items: center`
- **左侧**：
  - **标题文字**：`与 Miyu 的对话`，24px 粗体 700，颜色 `#1F2937`
  - **状态指示**：✓ 绿色徽章，表示对话已完成/已保存
  - 字体：14px，颜色 `#10B981`

- **右侧**（操作按钮）：
  - **[⏮ 上一个]**：跳转到上一条对话，禁用态 opacity 0.5
  - **[下一个 ⏭]**：跳转到下一条对话，禁用态 opacity 0.5
  - **[⋮ 更多]**：下拉菜单
    - 编辑对话标题
    - 编辑对话描述
    - 删除对话
    - 导出对话（JSON/PDF）
    - 查看历史版本
  - 按钮样式：高 36px，宽 100px，背景透明边框，圆角 6px，Hover 背景 `#F3F4F6`

### 3.3 副标题行
- **文字**：`这是你的对话项目快照。`
- **字体**：14px，颜色 `#6B7280`
- **右侧**（元数据）：
  - 创建时间：`创建于: 2025-11-10 14:32`
  - 最后编辑：`最后编辑: 2小时前`
  - 字体：12px，颜色 `#9CA3AF`

---

## 4. 中间对话内容区

### 4.1 容器属性
- **背景**：白色 `#FFFFFF`
- **宽度**：计算值 `calc(100% - 280px - 350px - 80px)`（侧栏 + 右板 + 间距）
- **高度**：`calc(100vh - 80px - 60px)`（标题栏 + 底部操作栏）
- **内边距**：20px（内部消息间距）
- **边框**：右侧 1px solid `#E5E7EB`（分隔右侧分析板）
- **滚动**：`overflow-y: auto`，自定义滚动条

### 4.2 对话气泡（同 Chat Window）
参考 `ui-design-01-chat-window.md` 第 3 节

**调整**：
- **消息时间戳**：每条消息下方显示，格式 `14:32`
- **消息分组**：按天分组，显示日期分隔线（如 "2025-11-10"）
- **关键标记**：
  - 重要消息（由 AI 标记）：右上角 ⭐，深度灰色背景轻度强调
  - 转折点（好感度大幅变化）：消息右侧显示好感度变化 `+20` 或 `-5`

### 4.3 中间插入元素

#### AI 思考中指示器
```
[思考图标] AI 分析中...
```
- 显示在对话列表中间
- 高度 40px，背景 `rgba(59, 130, 246, 0.1)`
- 文字：`AI 分析中...`，13px，颜色蓝色
- 脉冲动画

#### 添加消息按钮
```
[+ 添加消息]
```
- 位置：对话列表底部
- 样式：按钮样式，高 40px，背景 `rgba(217, 27, 92, 0.1)`，文字粉红色
- 点击后打开消息编辑对话框

---

## 5. 底部操作栏（中间列）

### 5.1 操作栏布局
```
[😊]    [⏸]    [✨]    [⚙]    [💾 保存]
```

- **高度**：64px
- **背景**：白色 `#FFFFFF`，上方 1px 分隔线
- **内边距**：16px
- **布局**：Flexbox 横向，`justify-content: center, gap: 24px`
- **右侧**："保存"按钮靠右对齐

### 5.2 按钮定义
- **[😊]、[⏸]、[✨]、[⚙]**：同 Chat Window
- **[💾 保存]**：
  - 背景：品牌粉红 `#D91B5C`
  - 文字：白色，13px 粗体
  - 内边距：10px 24px
  - 圆角：6px
  - Hover：背景 `#C2185B`
  - 点击后短暂变为 "✓ 已保存"，1 秒后恢复

---

## 6. 右侧分析板

### 6.1 板块容器
- **宽度**：350px（固定）
- **背景**：`#F9FAFB`（极浅灰）
- **高度**：100vh
- **内边距**：20px
- **滚动**：`overflow-y: auto`
- **边框**：左侧 1px solid `#E5E7EB`

### 6.2 标题栏
```
AI 分析与编辑
```
- **文字**：`AI 分析与编辑`
- **字体**：16px 粗体 600，颜色 `#1F2937`
- **下边距**：20px
- **下方有 1px 分隔线** `#E5E7EB`

### 6.3 分析卡片（多个）

#### 卡片容器
```
┌─────────────────────────────┐
│ 你似乎平衡了主动性与被动性 │
│ 很好！                      │
│                             │
│ [编辑消息]                  │
└─────────────────────────────┘
```

**样式**：
- **背景**：白色 `#FFFFFF`
- **圆角**：8px
- **边框**：1px solid `#E5E7EB`
- **内边距**：16px
- **间距**：卡片之间 12px
- **阴影**：`0 1px 2px rgba(0, 0, 0, 0.05)`
- **Hover**：阴影升高到 `0 2px 4px rgba(0, 0, 0, 0.1)`

#### 卡片内容
- **分析文本**：14px，行高 1.6，颜色 `#374151`
- **icon**（可选）：卡片左上角小图标（如 💭、💡、⚠ 等），尺寸 20px

#### 编辑按钮
- **位置**：卡片底部，右对齐
- **文字**：`[编辑消息]`
- **样式**：
  - 背景：蓝色 `#3B82F6`
  - 文字：白色，12px 粗体
  - 内边距：6px 12px
  - 圆角：4px
  - Hover：背景 `#2563EB`

### 6.4 分析卡片类型与显示规则

| 类型 | 图标 | 样本文本 | 触发条件 |
|------|------|------|------|
| 正面反馈 | 💭 | 你似乎平衡了主动性与被动性，很好！ | AI 判定消息质量高 |
| 中立观察 | 💡 | 暂无推荐 | 无特殊建议或中性回应 |
| 改进建议 | ⚠️ | 在对方提到"最近工作有点累"时，你转移了话题。建议：多关心对方状态。 | AI 检测到可改进点 |
| 关键转折 | 🎯 | 进一步建议：下次对话中提及这个话题。 | 消息引发好感度大幅变化 |

### 6.5 AI 复盘分析

位置：分析卡片集合底部

```
┌──────────────────────────────────┐
│ AI 复盘                          │
│ ────────────────────────────────│
│ 你做得很棒，这次对话中你...     │
│ ...（省略部分内容）...           │
│ ...保持了自然和真诚。           │
│                                 │
│        [查看完整分析] →         │
└──────────────────────────────────┘
```

**样式**：
- **背景**：品牌粉色极淡版 `rgba(217, 27, 92, 0.05)`
- **圆角**：8px
- **边框**：1px solid `rgba(217, 27, 92, 0.2)`
- **内边距**：16px
- **标题**：`AI 复盘`，14px 粗体 600，颜色 `#D91B5C`
- **下方分隔线**：1px `rgba(217, 27, 92, 0.1)`
- **摘要文本**：
  - 字体：13px，行高 1.6，颜色 `#374151`
  - 最多显示 3 行，超出显示省略号
- **[查看完整分析] →**：
  - 链接样式，文字 `#D91B5C`，13px
  - Hover：下划线
  - 点击打开全屏分析页面（或模态框）

---

## 7. 好感度曲线（对话详情页变体）

### 7.1 触发方式
右侧分析板有一个 "📊 好感度变化" 折叠卡片（可选显示）

```
┌──────────────────────────┐
│ 📊 好感度变化  ▼         │ ← 点击展开/折叠
├──────────────────────────┤
│ ┌────────────────────┐  │
│ │   [曲线图]         │  │
│ │ 50 ─────────────→ │  │
│ │     ↗   ↗      │  │
│ │        70       │  │
│ │ (当前分数)      │  │
│ └────────────────────┘  │
│ 本次对话好感度变化:      │
│ 初始: 50 → 最终: 70    │
│ 变化: +20              │
└──────────────────────────┘
```

**样式**：
- **折叠头**：背景 `#F3F4F6`，高 44px，圆角 8px（仅顶部），内边距 12px
- **展开内容**：背景白色，圆角 8px（仅底部），内边距 16px
- **曲线图表**：
  - 使用简单的 SVG 或 Canvas 绘制
  - x 轴：对话阶段（消息编号）
  - y 轴：好感度分数（0-100）
  - 线条颜色：渐变 `#3B82F6` → `#D91B5C`
  - 圆点标记关键转折点
  - 宽度：100%，高度 150px

### 7.2 统计数据展示
- **初始好感度**：50
- **最终好感度**：70
- **总变化**：+20
- **高峰**：72（第 8 条消息后）
- **低谷**：48（第 3 条消息后）

---

## 8. 消息编辑模态框

### 8.1 触发方式
- 点击"[编辑消息]"按钮
- 或在中间对话区右键点击消息气泡选择"编辑"

### 8.2 对话框属性
- **宽度**：600px
- **背景**：白色
- **圆角**：12px
- **阴影**：`0 10px 40px rgba(0, 0, 0, 0.2)`

### 8.3 对话框结构
```
┌────────────────────────────────────────────┐
│ 编辑消息                               [×] │
├────────────────────────────────────────────┤
│ 角色：                                     │
│ ◎ Miyu      ◎ 我 (Player)                 │
│                                            │
│ 消息内容：                                 │
│ ┌──────────────────────────────────────┐  │
│ │ 听起来真不错！也可以这么说，我听说...│  │
│ │                                      │  │
│ └──────────────────────────────────────┘  │
│                                            │
│ 标记为关键：☐ 此消息为攻略关键转折点    │
│                                            │
│            [保存修改]  [取消]             │
└────────────────────────────────────────────┘
```

### 8.4 字段定义

#### 角色选择
- **格式**：单选按钮（Radio）
- **选项**：
  - ◎ Miyu（对方）
  - ◎ 我 (Player)（用户自己）
- **默认**：根据被编辑消息的角色自动选中
- **不可改变对方为用户**（防止数据混乱）

#### 消息内容
- **标签**：`消息内容：`，13px 粗体
- **文本框**：
  - 高 120px
  - 背景 `#F9FAFB`，边框 1px `#D1D5DB`
  - 圆角 6px
  - 可调整大小
  - Focus：边框 `#D91B5C`

#### 关键标记复选框
- **样式**：标准 checkbox + 标签
- **标签**：`此消息为攻略关键转折点`，13px，颜色 `#374151`
- **选中时**：右侧显示小星标 ⭐
- **影响**：选中后，该消息在对话区会显示星标，在分析中优先级提高

### 8.5 按钮栏
- **[保存修改]**：品牌粉红，保存后关闭对话框
- **[取消]**：透明边框，关闭不保存

---

## 9. 全屏分析页面（可选扩展）

### 9.1 触发方式
点击右侧分析板中的 "[查看完整分析] →"

### 9.2 页面内容
```
[返回] 完整 AI 分析报告          [导出为 PDF]

=====================================================

对话分析报告

对话标题：与 Miyu 的对话
对话日期：2025-11-10 14:32
分析时间：2025-11-10 15:45

─────────────────────────────────────────────────

做得很好的地方 ✓
• 及时回应对方邀约，表现出兴趣，效果：好感度 +15
• 主动提及共同话题（旅游和咖啡），拉近距离，效果：好感度 +8
• ...

可以改进的地方 ⚠
• 在对方提到"最近工作有点累"时，你转移了话题。
  建议：多关心对方状态，增进情感连接。
• 回应长度偏短，缺乏深度。
  建议：加入 1-2 个细节或真诚的感受。

下次对话建议 💡
1. 主动询问对方的工作情况（因为之前她提过压力）
2. 分享你最近的经历，建立相互理解
3. 邀请对方参加共同感兴趣的活动

═════════════════════════════════════════════════

好感度变化详解

初始好感度：50
最终好感度：70
总变化：+20

过程分析：
• 第 1-3 条消息：好感度 50 → 55（缓慢上升）
  原因：互动开放，但缺乏特殊吸引力
• 第 4-6 条消息：好感度 55 → 70（快速上升）
  原因：话题契合度高，双方共鸣增加
• ...

═════════════════════════════════════════════════

[导出为 PDF]  [返回]
```

**样式**：
- 单列布局，宽度 900px，居中
- 背景：白色
- 排版：清晰分段，标题粗体 18px，正文 14px
- 导出按钮：右上固定或底部居中

---

## 10. 交互动画

### 10.1 右侧分析板入场
- 从右侧 `translateX(100%)` 滑入到 `translateX(0)`，300ms ease-out

### 10.2 分析卡片加载
- Stagger 效果，每张卡片延迟 50ms
- 从下方 `translateY(20px), opacity: 0` 到 `translateY(0), opacity: 1`

### 10.3 好感度曲线动画
- 折叠卡片展开时，曲线图从 0% 宽度动画到 100%，500ms ease-out

---

## 11. 响应式设计

### 11.1 桌面版（≥ 1400px）
- 三列布局：侧栏 280px + 中间 flex + 右板 350px
- 对话内容全量显示

### 11.2 平板版（1000px ~ 1399px）
- 三列压缩：侧栏可折叠，右板宽度减少到 300px

### 11.3 小屏版（< 1000px）
- 右侧分析板改为上滑模态框（Sheet Modal）
- 对话内容占据大部分宽度

---

## 12. 键盘快捷键 & 无障碍

### 12.1 快捷键
- **Ctrl+S**：保存对话
- **Ctrl+E**：编辑当前消息
- **Ctrl+Z**：撤销编辑
- **Escape**：关闭编辑对话框或关闭分析板

### 12.2 屏幕阅读器
- 消息气泡有 `role="article"` 和 `aria-label`（含消息主体）
- 分析卡片有 `role="region"` 和 `aria-labelledby`
- 按钮有 `aria-label` 和 `aria-pressed`（切换类按钮）

### 12.3 颜色对比度
- 所有文字与背景对比度 ≥ 4.5:1

---

## 13. 技术实现提示

### 13.1 React 组件结构
```jsx
<ConversationDetailPage conversationId={id}>
  <Sidebar activeTab="conversation-editor" />
  
  <MainConversationArea>
    <HeaderBar title={conversation.title} />
    <MessageList messages={messages} />
    <ActionBar onSave={handleSave} />
  </MainConversationArea>

  <AnalysisSidebar>
    <AnalysisCards analyses={analyses} />
    <AIReviewCard review={aiReview} />
    <SentimentChart />
  </AnalysisSidebar>

  {showEditMessageModal && (
    <EditMessageModal 
      message={selectedMessage}
      onSave={handleSaveMessage}
      onClose={closeModal}
    />
  )}

  {showFullAnalysis && (
    <FullAnalysisPage conversationId={id} onClose={closeFullAnalysis} />
  )}
</ConversationDetailPage>
```

### 13.2 数据结构
```typescript
interface Message {
  id: string;
  role: 'user' | 'partner';
  content: string;
  timestamp: Date;
  isKeyTurningPoint: boolean;
  sentimentImpact: number; // -20 to +20
}

interface Analysis {
  type: 'positive' | 'neutral' | 'improvement' | 'turning_point';
  text: string;
  messageId?: string;
  icon: string;
}

interface ConversationDetail {
  id: string;
  title: string;
  partnerId: string;
  messages: Message[];
  analyses: Analysis[];
  aiReview: string;
  sentimentCurve: number[]; // 好感度序列
}
```

### 13.3 样式方案
- **Tailwind CSS** + 自定义变量
- **Recharts** 或 **Chart.js** 绘制好感度曲线

### 13.4 状态管理
- 使用 **Zustand** 或 **Jotai** 管理对话内容和编辑状态
- 使用 **React Query** 缓存分析数据

---

## 14. 设计资源清单

### 14.1 图标
- 返回 ⏮、前进 ⏭、更多 ⋮、保存 💾、思考 💭、灯泡 💡、警告 ⚠、目标 🎯、图表 📊、导出 📄

### 14.2 颜色变量表
```css
:root {
  --brand-primary: #D91B5C;
  --brand-light: rgba(217, 27, 92, 0.05);
  
  --bg-page: #F5F7FA;
  --bg-card: #FFFFFF;
  --bg-input: #F9FAFB;
  --bg-chart: #F9FAFB;
  
  --text-primary: #1F2937;
  --text-secondary: #6B7280;
  --text-muted: #9CA3AF;
  
  --border-default: #E5E7EB;
  
  --status-positive: #10B981;
  --status-neutral: #6B7280;
  --status-improvement: #F59E0B;
  --status-turning: #D91B5C;
}
```

---

## 15. 验收标准

### 15.1 视觉还原度
- [ ] 标题栏与副标题排版正确
- [ ] 消息气泡格式（含时间、星标、好感度变化）完整
- [ ] 右侧分析卡片样式一致
- [ ] 好感度曲线图表清晰
- [ ] 编辑消息对话框表单正确

### 15.2 交互流畅性
- [ ] 右侧分析板滑入/滑出流畅
- [ ] 分析卡片加载 stagger 动画平滑
- [ ] 曲线图展开动画自然
- [ ] 消息编辑对话框打开/关闭无闪烁

### 15.3 功能完整性
- [ ] 消息可编辑，修改后实时显示
- [ ] 关键标记可正确设置/取消
- [ ] 分析卡片内容准确反映对话内容
- [ ] AI 复盘分析文字清晰
- [ ] 查看完整分析可正确打开全屏页面

### 15.4 跨平台一致性
- [ ] Windows 和 macOS 三列布局对齐
- [ ] 字体渲染清晰
- [ ] 图表在两平台显示一致

---

**文档版本**：v1.0  
**最后更新**：2025-11-12  
**维护者**：产品设计团队

